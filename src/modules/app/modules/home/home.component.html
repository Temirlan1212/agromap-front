<app-side-panel>
  <app-contour-filter
    (onCardClick)="map.handleFeatureClick($event.layer, $event.feature)"
    (onEditClick)="map.handleFeatureClose()"
  >
  </app-contour-filter>
  <router-outlet></router-outlet>
</app-side-panel>

<div class="map-container">
  <app-map
    #map
    (mapData)="handleMapData($event)"
    (mapMove)="handleMapMove($event)"
    (featureClick)="handleFeatureClick($event)"
    (featureClose)="handleFeatureClose()"
  >
    <app-map-controls controls>
      <div rightPanel>
        <app-map-control-split-map  
          [routerLink]="currentRouterPathname === '/home/split-map' ? '/home' : '/home/split-map'"
          *ngIf="layerFeature"
          [isActive]="currentRouterPathname === '/home/split-map'"
        >
        </app-map-control-split-map>
        <app-map-control-locate
          *ngIf="mapData && !layerFeature"
          [map]="mapData.map"
        ></app-map-control-locate>
      <ng-container rightPanel>
        <app-map-control-zoom
          *ngIf="mapData"
          [map]="mapData.map"
        ></app-map-control-zoom>
        <app-map-control-layers-switch
          *ngIf="mapData"
          [map]="mapData.map"
        ></app-map-control-layers-switch>
        <app-map-control-locate
          *ngIf="mapData"
          [map]="mapData.map"
        ></app-map-control-locate>
        <app-map-control-ai
          *ngIf="mapData"
          [map]="mapData.map"
          [wms]="isWmsAiActive ? wmsAi : null"
          (clicked)="handleMapControlAi($event)"
        ></app-map-control-ai>
      </ng-container>

      <ng-container topPanel>
        <app-map-control-veg-indexes
          *ngIf="layerFeature && mapData"
          [layer]="layerFeature"
          [mapData]="mapData"
          [vegIndexesData]="vegIndexesData"
          [vegIndexOptionsList]="vegIndexOptionsList"
          (vegIndexOptionClick)="handleVegIndexOptionClick($event)"
          [loadingSatelliteDates]="loadingSatelliteDates"
        ></app-map-control-veg-indexes>
      </ng-container>
    </app-map-controls>

    <app-spline-area-chart
      [chartData]="contourData"
      *ngIf="layerFeature && contourData.length > 0; else noContourData"
    >
    </app-spline-area-chart>
    <ng-template #noContourData>
      <h3 class="no-data-text">{{ "NoData" | translate }}</h3>
    </ng-template>
  </app-map>

  <app-split-map *ngIf="currentRouterPathname === '/home/split-map'"></app-split-map>
</div>
